// Database schema for Insurance Claims Management System

Table customers {
  id bigint [pk, increment]
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  email varchar(255) [not null, unique]
  phone varchar(20) [not null]
  address text [not null]
  date_of_birth date [not null]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  is_active boolean [default: true]

  indexes {
    email [unique]
  }
}

Table policies {
  id bigint [pk, increment]
  customer_id bigint [ref: > customers.id]
  policy_number varchar(50) [not null, unique]
  policy_type varchar(50) [not null] // e.g., auto, home, health
  start_date date [not null]
  end_date date [not null]
  premium_amount decimal(10,2) [not null]
  coverage_details jsonb [not null]
  status varchar(20) [not null] // active, expired, cancelled
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]

  indexes {
    policy_number [unique]
    customer_id
  }
}

Table claims {
  id bigint [pk, increment]
  policy_id bigint [ref: > policies.id]
  claim_number varchar(50) [not null, unique]
  claim_type varchar(50) [not null]
  description text [not null]
  incident_date date [not null]
  claim_date date [not null]
  status varchar(20) [not null] // pending, approved, rejected, paid
  estimated_amount decimal(10,2) [not null]
  approved_amount decimal(10,2)
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]

  indexes {
    claim_number [unique]
    policy_id
  }
}

Table incidents {
  id bigint [pk, increment]
  claim_id bigint [ref: > claims.id]
  incident_type varchar(50) [not null]
  location text [not null]
  description text [not null]
  reported_date timestamp [not null]
  severity varchar(20) [not null] // low, medium, high
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]

  indexes {
    claim_id
  }
}

Table documents {
  id bigint [pk, increment]
  claim_id bigint [ref: > claims.id]
  document_type varchar(50) [not null]
  file_name varchar(255) [not null]
  file_path text [not null]
  file_size bigint [not null]
  mime_type varchar(100) [not null]
  uploaded_at timestamp [default: `now()`]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]

  indexes {
    claim_id
  }
}

Table payments {
  id bigint [pk, increment]
  claim_id bigint [ref: > claims.id]
  amount decimal(10,2) [not null]
  payment_date date [not null]
  payment_method varchar(50) [not null]
  status varchar(20) [not null] // pending, completed, failed
  transaction_id varchar(100) [unique]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]

  indexes {
    transaction_id [unique]
    claim_id
  }
}

Table users {
  id bigint [pk, increment]
  username varchar(50) [not null, unique]
  email varchar(255) [not null, unique]
  password_hash varchar(255) [not null]
  role varchar(20) [not null] // admin, agent, adjuster
  is_active boolean [default: true]
  last_login timestamp
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table audit_logs {
  id bigint [pk, increment]
  user_id bigint [ref: > users.id]
  action varchar(50) [not null]
  entity_type varchar(50) [not null]
  entity_id bigint [not null]
  old_values jsonb
  new_values jsonb
  created_at timestamp [default: `now()`]

  indexes {
    user_id
  }
}
